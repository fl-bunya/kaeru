# 帰宅時の電車発車時刻を取得してみる。いろんな言語で。

## モチベーション
電車が20-30分に1本しかないので、退社前に電車の発車時刻を確認している。  
毎回Yahoo乗り換え案内を開いて確認するのが面倒だったので、スクリプトを書いてみる。

## 実装方法
いい感じの乗り換えAPIがなかったので、Yahoo乗り換え案内ページをスクレイピングする。

### Yahoo乗り換え案内ページのクエリパラメータ
```typescript
const params = {
  from: '新富町(東京都)',
  to: '上福岡',
  y: '2025',           // 年
  m: '07',             // 月
  d: '23',             // 日
  hh: '23',            // 時
  m1: '3',             // 分（十の位）
  m2: '8',             // 分（一の位）
  type: '1',           // 検索タイプ
  ticket: 'ic',        // チケットタイプ
  expkind: '1',        // 急行種別
  userpass: '1',       // ユーザーパス
  ws: '3',             // 歩行速度
  s: '2',              // 検索条件
  al: '0',             // エレベーター
  shin: '0',           // 新幹線
  ex: '0',             // 特急
  hb: '1',             // バス
  lb: '1',             // 路線バス
  sr: '1'              // ソート
};
```

### 実行結果
```
🚇 Yahoo乗換案内からルート情報を取得中...
Fetching transit routes from: https://transit.yahoo.co.jp/search/result?...

📋 取得したルート情報 (3件):

=== ルート 1 ===
発車時刻: 21:42
到着時刻: 22:54
ルート: 東京メトロ有楽町線川越市行 → 東武東上線川越市行

=== ルート 2 ===
発車時刻: 22:03
到着時刻: 23:11
ルート: 東京メトロ有楽町線森林公園行 → 東武東上線森林公園行

=== ルート 3 ===
発車時刻: 22:25
到着時刻: 23:37
ルート: 東京メトロ有楽町線森林公園行 → 東武東上線森林公園行
```

## いろんな言語で作ってみる

### 対象言語
Rust, Go, Node.js, Bun, Deno

### 比較内容
- 本番ビルドでの実行結果（JSはbundle, minify。Bun、Denoはコンパイルした単一実行ファイルでも比較。）
- 開発モードでの実行結果

ネットワーク状況や各言語でのスクレイピングライブラリの実装の差があるので、ガバガバの比較。  
JSのファイルサイズは、ランタイムの事も考慮しなければならない。  

### 結果
詳細は[README.md](./README.md)に記載。

### 感想
GoかBunが個人的には良いと感じた。

- **Rust**: 最速。実行ファイルサイズ、メモリ使用量が少ない。開発モードの実行はそんなに早くない（コンパイル遅い）。コンパイルエラー解消が辛い。
- **Go**: ほぼ最速。コンパイルも速い。フォルダ構成がシンプル。言語仕様も比較的シンプル。
- **Node.js**: Viteのおかげか、bundleファイルはJSの中では小さい。開発モードの実行が一番遅い。メモリ使用量がJSでは一番多い。（V8のせいか）
- **Bun**: 本番、開発モードともに、JSでは一番速い。メモリ使用量がJSでは一番少ない。（JavaScriptCoreのおかげか）
- **Deno**: セキュリティが厳しい、オーバーヘッドで色々遅め？

## 日常使いする
エイリアスを設定する。  
らくまっちにも言わせてみる。  
https://www.npmjs.com/package/rakumacchisay

```sh
# .zprofile
alias kaerunode='node /Users/bunya/my/kaeru/node/dist/index.js'
alias kaerubun='bun /Users/bunya/my/kaeru/bun/dist/index.js'
alias kaerurust='/Users/bunya/my/kaeru/rust/target/release/kaeru'
alias kaerugo='/Users/bunya/my/kaeru/go/kaeru'
alias kaeru='kaerurust'
alias kaerucchi='kaeru | grep 発車時刻 | head -n 1 | xargs -I {} npx rakumacchisay "{}"'
```

```sh
❯ kaerucchi

 _______________________________________________________________
/                                                               \
  発車時刻: 05:23
\________________________  _____________________________________/
                         |/

      .-.                     .-.
    (   y_....-----------.._(   ;)
      `.                         '\
      /       0         .      0   |
    .""`.             `-^-'        /
  /     |_                       ./`~~-.             .--.
  |        `"""~=-----------='""`     /""~         .   .--.
  `-._      /                   ~~--y    \.      /   /     \
    `""""--y__..     rakumachi       \    )__,,,/  /       /
                `\                  .(__./ ___,,,"`       /
                  \....--------='"`  _/              __ /
                      `---.......y--'`,,,______-==~"`

          ..::::::::::::::::::::::::::::::::..
        ::::::::::::::::::::::::::::::::::::::::
          ''::::::::::::::::::::::::::::::::''
```

おわり